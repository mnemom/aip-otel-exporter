{
  "title": "AIP Integrity Overview",
  "description": "Overview dashboard for AIP integrity checks and AAP verification results exported via @mnemom/aip-otel-exporter.",
  "layout_type": "ordered",
  "is_read_only": false,
  "notify_list": [],
  "reflow_type": "fixed",
  "tags": ["aip", "integrity", "otel"],
  "widgets": [
    {
      "definition": {
        "title": "Integrity Checks",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "definition": {
              "title": "Integrity Verdict Distribution",
              "type": "sunburst",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aip.integrity_checks.total{*} by {verdict}",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar"
                }
              ]
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 3 }
          },
          {
            "definition": {
              "title": "Integrity Checks per Minute",
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aip.integrity_checks.total{*} by {verdict}.as_rate()",
                      "aggregator": "avg"
                    }
                  ],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ],
              "yaxis": { "label": "checks/min", "include_zero": true }
            },
            "layout": { "x": 4, "y": 0, "width": 4, "height": 3 }
          },
          {
            "definition": {
              "title": "Current Integrity Ratio",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query1 / (query1 + query2 + query3)",
                      "limit": { "count": 1, "order": "desc" }
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aip.integrity_checks.total{verdict:clear}",
                      "aggregator": "sum"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:aip.integrity_checks.total{verdict:review_needed}",
                      "aggregator": "sum"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query3",
                      "query": "sum:aip.integrity_checks.total{verdict:boundary_violation}",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar"
                }
              ],
              "autoscale": false,
              "precision": 2,
              "custom_unit": "%",
              "conditional_formats": [
                { "comparator": ">=", "value": 0.95, "palette": "white_on_green" },
                { "comparator": ">=", "value": 0.85, "palette": "white_on_yellow" },
                { "comparator": "<", "value": 0.85, "palette": "white_on_red" }
              ]
            },
            "layout": { "x": 8, "y": 0, "width": 4, "height": 3 }
          }
        ]
      },
      "layout": { "x": 0, "y": 0, "width": 12, "height": 4 }
    },
    {
      "definition": {
        "title": "Concerns & Analysis",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "definition": {
              "title": "Concerns by Category",
              "type": "toplist",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query1",
                      "limit": { "count": 10, "order": "desc" }
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aip.concerns.total{*} by {category}",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar"
                }
              ]
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 3 }
          },
          {
            "definition": {
              "title": "Concerns by Severity",
              "type": "toplist",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query1",
                      "limit": { "count": 10, "order": "desc" }
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aip.concerns.total{*} by {severity}",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar"
                }
              ]
            },
            "layout": { "x": 4, "y": 0, "width": 4, "height": 3 }
          },
          {
            "definition": {
              "title": "Analysis Duration (p50 / p95 / p99)",
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    { "formula": "query1", "alias": "p50" },
                    { "formula": "query2", "alias": "p95" },
                    { "formula": "query3", "alias": "p99" }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "p50:aip.analysis.duration_ms{*}",
                      "aggregator": "avg"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "p95:aip.analysis.duration_ms{*}",
                      "aggregator": "avg"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query3",
                      "query": "p99:aip.analysis.duration_ms{*}",
                      "aggregator": "avg"
                    }
                  ],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ],
              "yaxis": { "label": "ms", "include_zero": true }
            },
            "layout": { "x": 8, "y": 0, "width": 4, "height": 3 }
          }
        ]
      },
      "layout": { "x": 0, "y": 4, "width": 12, "height": 4 }
    },
    {
      "definition": {
        "title": "AAP Verification",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "definition": {
              "title": "Verification Pass Rate",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query1 / (query1 + query2)",
                      "limit": { "count": 1, "order": "desc" }
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aap.verifications.total{verified:true}",
                      "aggregator": "sum"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:aap.verifications.total{verified:false}",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar"
                }
              ],
              "autoscale": false,
              "precision": 2,
              "custom_unit": "%",
              "conditional_formats": [
                { "comparator": ">=", "value": 0.98, "palette": "white_on_green" },
                { "comparator": ">=", "value": 0.9, "palette": "white_on_yellow" },
                { "comparator": "<", "value": 0.9, "palette": "white_on_red" }
              ]
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 3 }
          },
          {
            "definition": {
              "title": "Violations by Type",
              "type": "toplist",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query1",
                      "limit": { "count": 10, "order": "desc" }
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aap.violations.total{*} by {type}",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar"
                }
              ]
            },
            "layout": { "x": 4, "y": 0, "width": 4, "height": 3 }
          },
          {
            "definition": {
              "title": "Violations Over Time by Severity",
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:aap.violations.total{*} by {severity}.as_count()",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "timeseries",
                  "display_type": "bars"
                }
              ],
              "yaxis": { "label": "violations", "include_zero": true }
            },
            "layout": { "x": 8, "y": 0, "width": 4, "height": 3 }
          }
        ]
      },
      "layout": { "x": 0, "y": 8, "width": 12, "height": 4 }
    }
  ]
}
